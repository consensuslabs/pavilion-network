<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pavilion Network MVP - Test Interface</title>
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
    <link href="css/styles.css" rel="stylesheet" />
    <style>
        /* Fallback styles in case CSS doesn't load */
        body { font-family: Arial, sans-serif; margin: 20px; }
        .api-row { margin: 10px 0; }
        textarea { width: 100%; min-height: 100px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Pavilion Network MVP - Test Interface</h1>
    
    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'User')" id="defaultOpen">User APIs</button>
        <button class="tablinks" onclick="openTab(event, 'Video')">Video APIs</button>
        <button class="tablinks" onclick="openTab(event, 'Social')">Social APIs</button>
        <button class="tablinks" onclick="openTab(event, 'Blockchain')">Blockchain APIs</button>
        <button class="tablinks" onclick="openTab(event, 'Cache')">Cache Test</button>
    </div>

    <!-- User APIs Section -->
    <div id="User" class="tabcontent">
        <div class="api-row">
            <button class="button" onclick="checkHealth()">Health Check</button>
            <span>/health</span>
        </div>
        <textarea id="healthResult" readonly></textarea>
        <hr>
        <div class="api-row">
            <button class="button" onclick="login()">Login</button>
            <span>/auth/login</span>
        </div>
        <textarea id="loginResult" readonly></textarea>
    </div>

    <!-- Video APIs Section -->
    <div id="Video" class="tabcontent">
        <!-- Upload Video Section -->
        <h2>Upload Video</h2>
        <form id="uploadForm">
            <div class="api-row">
                <label for="videoFile">Video File:</label>
                <input type="file" id="videoFile" name="video" accept="video/*" required>
                <span class="file-info">Maximum file size: 100 MB</span>
            </div>
            <div class="api-row">
                <label for="title">Title:</label>
                <input type="text" id="title" placeholder="Enter video title" required>
            </div>
            <div class="api-row">
                <label for="description">Description:</label>
                <textarea id="description" placeholder="Enter video description"></textarea>
            </div>
            <div class="api-row">
                <button type="submit" class="button">Upload Video</button>
                <span>/video/upload</span>
            </div>
        </form>

        <!-- Upload Status Section -->
        <div id="uploadStatus" style="display: none;" class="status-container">
            <div class="status-header">
                <span class="status-badge" id="statusText">pending</span>
                <p id="statusMessage" class="status-message">-</p>
            </div>
            <div class="status-details">
                <p><strong>File Size:</strong> <span id="statusFileSize">-</span></p>
                <p><strong>IPFS CID:</strong> <span id="statusIpfsCid">-</span></p>
                <p><strong>Last Updated:</strong> <span id="statusUpdatedAt">-</span></p>
            </div>
        </div>

        <!-- Upload Progress -->
        <div id="uploadProgress" style="display: none;">
            <div id="uploadProgressBar" class="progress-bar">0%</div>
        </div>

        <!-- Upload Result -->
        <textarea id="uploadResult" rows="4" class="form-control mt-3" readonly></textarea>
        <hr>

        <!-- Transcode Video Section -->
        <h2>Transcode Video</h2>
        <div class="api-row">
            <input type="radio" id="transcodeCID" name="transcodeOption" value="cid" checked>
            <label for="transcodeCID">Transcode from CID</label>
            <input type="radio" id="transcodeUpload" name="transcodeOption" value="upload">
            <label for="transcodeUpload">Upload and Transcode</label>
        </div>
        <div id="transcodeCIDForm">
            <div class="api-row">
                <label for="transcodeCIDInput">Source CID:</label>
                <input type="text" id="transcodeCIDInput" placeholder="Enter source CID">
            </div>
        </div>
        <div id="transcodeUploadForm" style="display: none;">
            <div class="api-row">
                <label for="transcodeFile">Video File:</label>
                <input type="file" id="transcodeFile" accept="video/*">
            </div>
            <div class="api-row">
                <label for="transcodeTitle">Title:</label>
                <input type="text" id="transcodeTitle" placeholder="Enter video title">
            </div>
            <div class="api-row">
                <label for="transcodeDescription">Description:</label>
                <input type="text" id="transcodeDescription" placeholder="Enter video description">
            </div>
        </div>
        <div class="api-row">
            <button class="button" onclick="transcodeVideo()">Transcode Video</button>
            <span>/video/transcode</span>
        </div>
        <textarea id="transcodeResult" readonly></textarea>
        <hr>

        <!-- List Videos Section -->
        <h2>List Videos</h2>
        <div class="api-row">
            <button class="button" onclick="listVideos()">List Videos</button>
            <span>/video/list</span>
        </div>
        <textarea id="listResult" readonly></textarea>
        <div id="videoList"></div>
    </div>

    <!-- Social APIs Section -->
    <div id="Social" class="tabcontent">
        <div class="api-row">
            <button class="button" onclick="socialAction()">Social Action</button>
            <span>/social/action</span>
        </div>
        <textarea id="socialResult" readonly></textarea>
    </div>

    <!-- Blockchain APIs Section -->
    <div id="Blockchain" class="tabcontent">
        <div class="api-row">
            <button class="button" onclick="blockchainAnchor()">Blockchain Anchor</button>
            <span>/blockchain/anchor</span>
        </div>
        <textarea id="blockchainResult" readonly></textarea>
    </div>

    <!-- Cache Test Section -->
    <div id="Cache" class="tabcontent">
        <div class="api-row">
            <button class="button" onclick="testCache()">Test Cache</button>
            <span>/test/cache</span>
        </div>
        <textarea id="cacheResult" readonly></textarea>
    </div>

    <!-- Debug Info -->
    <div id="debug" style="margin-top: 20px; padding: 10px; background: #f0f0f0;">
        <h3>Debug Information</h3>
        <div id="debugInfo"></div>
    </div>

    <script>
        // Debug logging function
        function debugLog(message) {
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toISOString();
            debugInfo.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            console.log(`[${timestamp}] ${message}`);
        }

        // Log resource loading
        debugLog('Starting script loading...');
    </script>
    <script src="js/utils.js" onerror="debugLog('Failed to load utils.js')" onload="debugLog('utils.js loaded successfully')"></script>
    <script src="js/video.js" onerror="debugLog('Failed to load video.js')" onload="debugLog('video.js loaded successfully')"></script>
    <script>
        // Social API
        function socialAction() {
            debugLog('Calling social action API...');
            fetch("/social/action")
                .then(res => res.json())
                .then(data => {
                    debugLog('Social action API response received');
                    displayResult("socialResult", data);
                })
                .catch(err => {
                    debugLog('Social action API error: ' + err.message);
                    handleError("socialResult", err);
                });
        }

        // Blockchain API
        function blockchainAnchor() {
            debugLog('Calling blockchain anchor API...');
            fetch("/blockchain/anchor")
                .then(res => res.json())
                .then(data => {
                    debugLog('Blockchain anchor API response received');
                    displayResult("blockchainResult", data);
                })
                .catch(err => {
                    debugLog('Blockchain anchor API error: ' + err.message);
                    handleError("blockchainResult", err);
                });
        }

        // Cache Test
        function testCache() {
            debugLog('Calling cache test API...');
            fetch("/test/cache")
                .then(res => res.json())
                .then(data => {
                    debugLog('Cache test API response received');
                    displayResult("cacheResult", data);
                })
                .catch(err => {
                    debugLog('Cache test API error: ' + err.message);
                    handleError("cacheResult", err);
                });
        }

        // Health Check
        function checkHealth() {
            debugLog('Calling health check API...');
            fetch("/health")
                .then(res => res.json())
                .then(data => {
                    debugLog('Health check API response received');
                    displayResult("healthResult", data);
                })
                .catch(err => {
                    debugLog('Health check API error: ' + err.message);
                    handleError("healthResult", err);
                });
        }

        // Login
        function login() {
            debugLog('Calling login API...');
            fetch("/auth/login", { method: "POST" })
                .then(res => res.json())
                .then(data => {
                    debugLog('Login API response received');
                    displayResult("loginResult", data);
                })
                .catch(err => {
                    debugLog('Login API error: ' + err.message);
                    handleError("loginResult", err);
                });
        }

        // Initialize the application when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            debugLog('DOM Content Loaded - Initializing application...');
            try {
                initApp();
                debugLog('Application initialized successfully');
            } catch (err) {
                debugLog('Error initializing application: ' + err.message);
            }
        });
    </script>
</body>
</html>